var p=function(){function r(o,s){this.name=o.getAttribute("id")||void 0,this.originalAttributes=s||[],this.container=o,this._shadowElement=this.container.querySelector(".ambient__shadow")}return r.prototype.disable=function(){this._shadowElement.style.display!=="none"&&(this._shadowElement.style.display="none")},r.prototype.enable=function(){this._shadowElement.style.display!=="block"&&(this._shadowElement.style.display="block ")},r}(),g=function(){var r,o;function s(t){console.log("CREATING AMBIENT"),t=t||{},this.options=Object.assign({insertCSS:!0,retainAttributes:!1,blur:-1},t),this.options.insertCSS&&y(),this.options.blur>=0&&this.options.blur!==45&&(r=this.options.blur),o=this.options.retainAttributes,this.elements=[]}s.prototype.mount=function(t){console.log("MOUNTING");var n=document.querySelectorAll("img[data-ambient]");console.log(n),console.log(document.body.outerHTML);for(var e=0;e<n.length;e++)this.elements.push(w(n[e]));for(var a=document.querySelectorAll("video[data-ambient]"),e=0;e<a.length;e++)this.elements.push(A(a[e]));return this.elements},s.prototype.unmount=function(){this.elements.forEach(function(t){var n=t.container,e=n.querySelector(".ambient__visible");e.classList.remove("ambient__visible"),e.setAttribute("data-ambient",t.name||"");for(var a=0;a<t.originalAttributes.length;a++){var i=t.originalAttributes[a];(!e.hasAttribute(i.name)||e.getAttribute(i.name)!==i.value)&&e.setAttribute(i.name,i.value)}n.parentNode.insertBefore(e,n),n.parentNode.removeChild(n)}),this.elements=[]};function A(t){var n=t,e=document.createElement("div");e.className="ambient__container",n.getAttribute("data-ambient").length>0&&(e.id=n.getAttribute("data-ambient"));var a=n.cloneNode(!0),i=[];if(!o){i=a.attributes;for(var u=0;u<a.attributes.length;u++){var b=a.attributes[u].name.toLowerCase();b!=="src"&&a.removeAttribute(b)}}a.classList.add("ambient__visible");var c=document.createElement("canvas");return c.className="ambient__shadow",r&&f(c,r),a.removeAttribute("data-ambient"),function(l,d){var v=d.getContext("2d"),m=!1;function h(){v.clearRect(0,0,d.width,d.height),v.drawImage(l,0,0,d.width,d.height),m&&window.requestAnimationFrame(h)}l.onloadeddata=function(){window.requestAnimationFrame(h)},l.onplay=function(){m=!0,window.requestAnimationFrame(h)},l.onpause=function(){m=!1},l.onabort=function(){m=!1}}(a,c),e.appendChild(a),e.appendChild(c),n.parentNode.insertBefore(e,n),n.parentNode.removeChild(n),new p(e,i)}function w(t){console.log("RENDERING IMAGE");var n=document.createElement("div");n.className="ambient__container",t.getAttribute("data-ambient").length>0&&(n.id=t.getAttribute("data-ambient"));var e,a=[];o?e=t.cloneNode():(a=t.attributes,e=document.createElement("img"),e.src=t.src,e.alt=t.alt),e.classList.add("ambient__visible");var i=document.createElement("img");return i.className="ambient__shadow",i.src=e.src,r&&f(i,r),e.removeAttribute("data-ambient"),i.removeAttribute("data-ambient"),function(u,b){e.onload=function(){i.src=e.src}}(),n.appendChild(e),n.appendChild(i),t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t),new p(n,a)}function f(t,n){var e="blur("+n+"px)";t.style.filter=e,t.style.webkitFilter=e,t.style.mozFilter=e,t.style.msFilter=e}function y(){var t="LmFtYmllbnRfX2NvbnRhaW5lcntwb3NpdGlvbjpyZWxhdGl2ZX0uYW1iaWVudF9fdmlzaWJsZXtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO3otaW5kZXg6MTA7d2lkdGg6MTAwJX0uYW1iaWVudF9fc2hhZG93e2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTt6LWluZGV4OjU7bGVmdDowO3RvcDowOy13ZWJraXQtZmlsdGVyOmJsdXIoNDVweCk7LW1vei1maWx0ZXI6Ymx1cig0NXB4KTstbXMtZmlsdGVyOmJsdXIoNDVweCk7ZmlsdGVyOmJsdXIoNDVweCl9",n=document.createElement("style");n.textContent=atob(t);var e=document.querySelector("head");e.appendChild(n)}return s}();export{g as A};
